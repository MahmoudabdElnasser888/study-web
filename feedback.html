<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>صندوق الشكاوي والاقتراحات</title>
  <style>
    :root{
      --accent1: #00f5ff;
      --accent2: #8a2be2;
      --btn-shadow: 0 0 20px rgba(0,245,255,0.6);
      --bg-dark1: #000010;
      --bg-dark2: #000;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family:'Cairo',sans-serif;
      color:#fff;
      background:linear-gradient(135deg,var(--bg-dark1),var(--bg-dark2));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      overflow:hidden;
    }

    /* animated soft neon blobs in background */
    :root{
      --blob-opacity: 0.12;
    }
    .bg-blob {
      position:fixed;
      pointer-events:none;
      filter:blur(80px);
      opacity:var(--blob-opacity);
      mix-blend-mode:screen;
      z-index:0;
    }
    .b1{width:720px;height:720px;background:radial-gradient(circle at 30% 30%, var(--accent1), transparent 40%);left:-180px;top:-140px;animation:float1 16s infinite alternate}
    .b2{width:520px;height:520px;background:radial-gradient(circle at 70% 70%, var(--accent2), transparent 40%);right:-120px;bottom:-160px;animation:float2 18s infinite alternate}
    @keyframes float1{0%{transform:translate(0,0) rotate(0)}100%{transform:translate(40px,30px) rotate(6deg)}}
    @keyframes float2{0%{transform:translate(0,0) rotate(0)}100%{transform:translate(-36px,-18px) rotate(-6deg)}}

    .form-box{
      position:relative;
      z-index:2;
      width:100%;
      max-width:460px;
      background:rgba(0,0,0,0.7);
      border-radius:18px;
      padding:26px;
      box-shadow:0 8px 40px rgba(0,0,0,0.6), 0 0 40px rgba(138,43,226,0.06);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,0.03);
    }

    .form-box h2{
      margin:0 0 12px 0;
      color:var(--accent1);
      text-align:center;
      font-size:20px;
      font-weight:800;
      letter-spacing:0.6px;
    }

    label{display:block;color:#ddd;margin:8px 0 6px;font-weight:600;font-size:14px}
    input[type="text"], input[type="email"], textarea{
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.06);
      background:rgba(255,255,255,0.03);
      color:#fff;
      font-size:14px;
      outline:none;
      transition:box-shadow .18s, border-color .18s, background .18s;
      resize:vertical;
    }
    input::placeholder, textarea::placeholder{color:#999}

    input:focus, textarea:focus{
      box-shadow:0 6px 26px rgba(0,245,255,0.06);
      border-color:var(--accent1);
      background:rgba(0,0,0,0.55);
    }

    textarea{min-height:120px; max-height:300px}

    .submit-btn{
      width:100%;
      margin-top:8px;
      padding:12px;
      border-radius:12px;
      border:none;
      font-weight:800;
      font-size:15px;
      color:#071021;
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
      box-shadow: var(--btn-shadow);
      cursor:pointer;
      transition: transform .12s, box-shadow .12s, opacity .12s;
    }
    .submit-btn[disabled]{opacity:0.6; cursor:not-allowed}
    .submit-btn:hover:not([disabled]){ transform:translateY(-3px) }

    /* toast */
    .toast{
      position:fixed;
      top:20px;
      left:50%;
      transform:translateX(-50%);
      z-index:9999;
      display:none;
      padding:10px 16px;
      border-radius:10px;
      font-weight:700;
      color:#fff;
      box-shadow:0 8px 30px rgba(0,0,0,0.6);
    }
    .toast.success{ background: linear-gradient(90deg,#28a745,#0f8b44) }
    .toast.error{ background: linear-gradient(90deg,#dc3545,#a31d2a) }

    /* loader overlay */
    .loader-overlay{
      position:fixed;
      inset:0;
      display:none;
      z-index:9990;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.6));
    }
    .loader-card{
      background: linear-gradient(135deg, rgba(0,0,0,0.7), rgba(255,255,255,0.02));
      border-radius:12px;
      padding:16px 20px;
      display:flex;
      gap:14px;
      align-items:center;
      box-shadow:0 10px 40px rgba(0,0,0,0.6);
      border:1px solid rgba(255,255,255,0.03);
    }
    .spinner{
      width:56px;
      height:56px;
      border-radius:50%;
      background: conic-gradient(var(--accent1), var(--accent2));
      filter: blur(8px);
      position:relative;
      animation:spin 1.1s linear infinite;
    }
    .spinner::after{
      content:"";
      position:absolute;
      inset:8px;
      border-radius:50%;
      background:linear-gradient(180deg, rgba(255,255,255,0.08), rgba(0,0,0,0.2));
      filter: blur(0.6px);
    }
    @keyframes spin { to { transform: rotate(360deg) } }

    .loader-text{ color:#e6fbff; font-weight:700; font-size:15px }

    @media(max-width:520px){
      .form-box{padding:18px}
      .spinner{width:44px;height:44px}
    }
  </style>
</head>
<body>

  <div class="bg-blob b1"></div>
  <div class="bg-blob b2"></div>

  <div class="form-box" role="region" aria-label="صندوق الشكاوي">
    <h2>صندوق الشكاوي والاقتراحات</h2>

    <!-- IMPORTANT: action kept (email) but we'll use AJAX endpoint in JS -->
    <form id="complaintForm" action="https://formsubmit.co/modynasser164@gmail.com" method="POST" autocomplete="on">
      <input type="hidden" name="_captcha" value="false">
      <!-- _next isn't used with AJAX but kept harmless -->
      <input type="hidden" name="_next" value="https://yourwebsite.com/thanks.html">

      <label for="name">الاسم</label>
      <input type="text" id="name" name="name" placeholder="اكتب اسمك" required>

      <label for="email">البريد الإلكتروني</label>
      <input type="email" id="email" name="email" placeholder="example@mail.com" required>

      <label for="message">رسالتك</label>
      <textarea id="message" name="message" placeholder="اكتب الشكوى أو الاقتراح هنا" required></textarea>

      <button class="submit-btn" type="submit">إرسال</button>
    </form>
  </div>

  <!-- loader overlay -->
  <div class="loader-overlay" id="loaderOverlay" aria-hidden="true">
    <div class="loader-card" role="status" aria-live="polite">
      <div class="spinner" aria-hidden="true"></div>
      <div class="loader-text">جاري إرسال الرسالة... الرجاء الانتظار</div>
    </div>
  </div>

  <div id="toast" class="toast" role="alert" aria-live="assertive"></div>

  <script>
    (function(){
      const form = document.getElementById('complaintForm');
      const loader = document.getElementById('loaderOverlay');
      const toast = document.getElementById('toast');
      const submitBtn = form.querySelector('.submit-btn');

      function showLoader(on){
        loader.style.display = on ? 'flex' : 'none';
        submitBtn.disabled = on;
      }
      function showToast(msg, type='success'){
        toast.textContent = msg;
        toast.className = 'toast ' + (type==='success' ? 'success' : 'error');
        toast.style.display = 'block';
        setTimeout(()=>{ toast.style.display = 'none'; }, 3500);
      }

      // Build AJAX endpoint from form.action:
      // e.g. https://formsubmit.co/modynasser...  -> https://formsubmit.co/ajax/modynasser...
      const action = form.getAttribute('action') || '';
      const ajaxURL = action.startsWith('https://formsubmit.co/')
        ? action.replace('https://formsubmit.co/','https://formsubmit.co/ajax/')
        : action;

      // Submit handler using the AJAX endpoint (CORS-friendly)
      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        // basic form validity (HTML required attributes already enforce)
        const formData = new FormData(form);

        try{
          showLoader(true);

          // Set a timeout fallback (in case network hangs)
          const controller = new AbortController();
          const timeoutId = setTimeout(()=> controller.abort(), 20000); // 20s

          const resp = await fetch(ajaxURL, {
            method: 'POST',
            body: formData,
            signal: controller.signal,
            // no need to set headers (FormData sets them)
          });
          clearTimeout(timeoutId);

          // formsubmit/ajax returns JSON with "success" on ok
          if(resp.ok){
            // attempt parse JSON for extra info (not required)
            try {
              const data = await resp.json();
              // sometimes the service returns {success: true, message: "..."}
            } catch(_) {}
            showToast('✅ تم إرسال رسالتك بنجاح!', 'success');
            form.reset();
          } else {
            // non-OK HTTP status
            showToast('❌ حصل خطأ أثناء الإرسال، حاول مرة أخرى.', 'error');
            console.error('Form submission failed, status:', resp.status, resp.statusText);
          }
        } catch(err){
          if(err.name === 'AbortError'){
            showToast('❌ انتهاء وقت الاتصال. تحقق من الإنترنت وحاول مرة أخرى.', 'error');
          } else {
            // network / CORS / other
            showToast('❌ فشل الاتصال. إذا وصلت الرسالة فعليًا فالهاتف/الخادم أعاد رد غير قياسي.', 'error');
            console.error('Submission error:', err);
          }
        } finally{
          showLoader(false);
        }
      });

    })();
  </script>
</body>
</html>
