<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>حضارات شبه الجزيرة قبل الإسلام — درس تفاعلي كامل</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1:#1b0330; /* deep purple */
      --bg2:#060b2e; /* navy */
      --card:#0f1220;
      --glass: rgba(255,255,255,0.03);
      --accent:#8b5cf6;
      --accent-2:#6d28d9;
      --xp:#7cf1ff;
      --good:#7ef08b;
      --bad:#ff7b7b;
      --muted:#b9c3d1;
      font-family: 'Cairo', Tahoma, sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(120deg,var(--bg1),var(--bg2));color:#eef6ff;min-height:100vh;overflow-y:auto}

    /* animated background blobs */
    .bg-blob{position:fixed;pointer-events:none;filter:blur(70px);opacity:0.28;mix-blend-mode:screen}
    .b1{width:520px;height:520px;background:radial-gradient(circle at 30% 30%, #8b5cf6, transparent 40%);left:-120px;top:-80px;animation:float1 14s infinite}
    .b2{width:420px;height:420px;background:radial-gradient(circle at 70% 70%, #6d28d9, transparent 40%);right:-80px;bottom:-120px;animation:float2 16s infinite}
    @keyframes float1{0%{transform:translateY(0) rotate(0)}50%{transform:translateY(-18px) rotate(6deg)}100%{transform:translateY(0) rotate(0)}}
    @keyframes float2{0%{transform:translateY(0) rotate(0)}50%{transform:translateY(16px) rotate(-6deg)}100%{transform:translateY(0) rotate(0)}}

    .container{max-width:980px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;gap:16px}
    .logo{width:78px;height:78px;border-radius:14px;background:linear-gradient(135deg,var(--accent-2),var(--accent));display:flex;align-items:center;justify-content:center;box-shadow:0 12px 40px rgba(109,40,217,0.12)}
    .logo h1{margin:0;font-size:18px;color:white}
    header h2{margin:0;font-size:20px}
    .meta{color:var(--muted);font-size:13px}

    /* XP bar top */
    .xp-wrap{display:flex;gap:12px;align-items:center;margin-top:14px}
    .xp-bar{flex:1;height:16px;background:linear-gradient(90deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));border-radius:999px;padding:3px}
    .xp-fill{height:100%;width:0;background:linear-gradient(90deg,var(--xp),#a28bff);border-radius:999px;transition:width .6s ease}
    .xp-info{min-width:160px;text-align:left;color:var(--muted);font-weight:700}

    main{margin-top:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.02)}
    .paragraph-title{display:flex;align-items:center;gap:12px}
    .num-badge{width:44px;height:44px;border-radius:10px;background:linear-gradient(180deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800}
    h3{margin:6px 0;color:#fff}
    p{color:var(--muted);line-height:1.7}

    .controls{display:flex;gap:8px;margin-top:10px}
    .btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#071021;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}

    .question{margin-top:12px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border-radius:10px}
    .opts{display:flex;flex-direction:column;gap:8px;margin-top:8px}
    .opt{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;cursor:pointer}
    .opt.correct{outline:3px solid rgba(126,240,139,0.12);box-shadow:0 6px 18px rgba(126,240,139,0.06)}
    .opt.wrong{outline:3px solid rgba(255,123,123,0.1)}

    .badge-level{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03);color:var(--muted);font-weight:700}

    .hint{color:var(--muted);font-size:13px;margin-top:8px}

    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}

    /* confetti */
    .confetti-piece{position:fixed;z-index:2000;pointer-events:none}

    /* responsive */
    @media(max-width:720px){.xp-info{display:none} .logo{width:62px;height:62px} }
  </style>
</head>
<body>
  <div class="bg-blob b1"></div>
  <div class="bg-blob b2"></div>

  <div class="container">
    <header>
     
      <div>
        <h2>حضارات شبه الجزيرة العربية قُبيل ظهور الإسلام</h2>
        <div class="meta">درس كامل مُقسّم إلى فقرات، كل فقرة لها سؤال — اكسب نقاط XP بالتقدم.</div>
      </div>
      <div style="margin-inline-start:auto;text-align:left">
        <div class="badge-level" id="levelBadge">المستوى: مبتدئ</div>
      </div>
    </header>

    <div class="xp-wrap">
      <div class="xp-bar"><div class="xp-fill" id="xpFill"></div></div>
      <div class="xp-info" id="xpInfo">XP: <strong id="xpCount">0</strong> / <span id="xpNext">150</span></div>
    </div>

    <main>
      <!-- Paragraph 1 -->
      <article class="card" id="para1">
        <div class="paragraph-title"><div class="num-badge">1</div><h3>شبه الجزيرة العربية جزء لا يتجزأ من تاريخ الحضارة قبل الإسلام</h3></div>
        <p>العرب استوطنوا شبه الجزيرة وهم أمة سامية الأصل نسبة إلى سام بن نوح عليه السلام. تمتد جذور السكان والعادات في هذه المنطقة لآلاف السنين، مما جعلها أرضًا خصبة لظهور ممالك ومدن وتكوّن هويات حضارية متعددة قبل الإسلام.</p>
        <div class="controls">
          <button class="btn" data-read="1">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="1">عرض السؤال</button>
        </div>
        <div class="question" id="q1" style="display:none">
          <div class="muted">س1: ما أصل العرب بحسب الدرس؟</div>
          <div class="opts">
            <div class="opt" data-correct="true">أصلهم سامي نسبة إلى سام بن نوح</div>
            <div class="opt">أصلهم جرماني</div>
            <div class="opt">أصلهم هندي</div>
          </div>
          <div class="hint">معلومة: ستأخذ بونص عند الإجابة الصحيحة!</div>
        </div>
      </article>

      <!-- Paragraph 2 -->
      <article class="card" id="para2">
        <div class="paragraph-title"><div class="num-badge">2</div><h3>شبه الجزيرة العربية قبل الإسلام — ملامح عامة</h3></div>
        <p>• العرب عاشوا فيها آلاف السنين.
        <br>• أنشأوا ممالك ومدن وحضارات.
        <br>• اعتمدوا على الاستقرار والتواصل مع الحضارات الأخرى.</p>
        <div class="controls">
          <button class="btn" data-read="2">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="2">عرض السؤال</button>
        </div>
        <div class="question" id="q2" style="display:none">
          <div class="muted">س2: أي مما يلي ليس من ملامح شبه الجزيرة قبل الإسلام؟</div>
          <div class="opts">
            <div class="opt">الاستقرار والتواصل مع حضارات أخرى</div>
            <div class="opt" data-correct="true">اعتماد كامل على الصناعة الثقيلة</div>
            <div class="opt">وجود ممالك ومدن</div>
          </div>
        </div>
      </article>

      <!-- Paragraph 3 -->
      <article class="card" id="para3">
        <div class="paragraph-title"><div class="num-badge">3</div><h3>بعض ممالك ومدن شبه الجزيرة العربية</h3></div>
        <p>الممالك/المدن المهمة: سبأ-معين-حمير في جنوب شبه الجزيرة (اليمن). الأنباط-تدمر-الغساسنة ممالك الشام. الحيرة ممالك العراق. مكة المكرمة-يثرب(المدينة)-الطائف في الحجاز.
        <br>معين،سبأ،حمير،تدمر،الانباط ممالك كونت حضارات وسقطت قبل ظهور الإسلام. الغساسنة،الحيرة،مكة،يثرب،الطائف مناطق شكلت مناخًا حضاريًّا قبل ميلاد الرسول ﷺ وظهور الإسلام.</p>
        <div class="controls">
          <button class="btn" data-read="3">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="3">عرض السؤال</button>
        </div>
        <div class="question" id="q3" style="display:none">
          <div class="muted">س3: أي من هذه الممالك تقع في اليمن؟</div>
          <div class="opts">
            <div class="opt" data-correct="true">سبأ</div>
            <div class="opt">الأنباط</div>
            <div class="opt">الغساسنة</div>
          </div>
        </div>
      </article>

      <!-- Paragraph 4 -->
      <article class="card" id="para4">
        <div class="paragraph-title"><div class="num-badge">4</div><h3>ممالك جنوب شبه الجزيرة (اليمن): سقطت قبل ظهور الإسلام</h3></div>
        <p>أمثلة: مملكة معين (العاصمة الجوف)، مملكة سبأ (عاصمتها مأرب) — اشتهرت بسد مأرب وبتجارتها، ومملكة حمير. الملكة بلقيس مذكورة في القرآن في سورة النمل. انهيار سد مأرب تسبب في هجرة قبائل إلى أنحاء شبه الجزيرة.</p>
        <div class="controls">
          <button class="btn" data-read="4">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="4">عرض السؤال</button>
        </div>
        <div class="question" id="q4" style="display:none">
          <div class="muted">س4: ما أثر انهيار سد مأرب؟</div>
          <div class="opts">
            <div class="opt" data-correct="true">هجرة العديد من القبائل إلى أجزاء متفرقة من شبه الجزيرة</div>
            <div class="opt">زيادة إنتاج الزراعة في اليمن</div>
            <div class="opt">تحول اليمن إلى دولة بحرية بحتة</div>
          </div>
        </div>
      </article>

      <!-- Paragraph 5 -->
      <article class="card" id="para5">
        <div class="paragraph-title"><div class="num-badge">5</div><h3>مدن غرب شبه الجزيرة (الحجاز)</h3></div>
        <p>مكة المكرمة: مركز ديني بسبب وجود الكعبة، ومركز اقتصادي وتجاري لموقعها على طريق القوافل بين الشام واليمن، وتنظيم رحلتي الشتاء والصيف، وأسواق مثل ذي المجاز ومجنة. يثرب: واحة زراعية وتجارية سكنتْها قبائل الأوس والخزرج وبعض اليهود. الطائف: مناخ معتدل وزراعة العنب، سكنتها قبائل ثقيف وهوازن.</p>
        <div class="controls">
          <button class="btn" data-read="5">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="5">عرض السؤال</button>
        </div>
        <div class="question" id="q5" style="display:none">
          <div class="muted">س5: أي من المدن التالية نظمت رحلتي الشتاء والصيف؟</div>
          <div class="opts">
            <div class="opt" data-correct="true">مكة</div>
            <div class="opt">يثرب</div>
            <div class="opt">الطائف</div>
          </div>
        </div>
      </article>

      <!-- Paragraph 6 -->
      <article class="card" id="para6">
        <div class="paragraph-title"><div class="num-badge">6</div><h3>ممالك الشام والعراق</h3></div>
        <p>الأنباط،تدمر،الغساسنة،الحيرة قامت على أطراف الصحراء العربية الشمالية كحد فاصل بين بلاد العرب ودولتي الروم والفرس. مملكة الحيرة كانت مرتبطة بالدولة الساسانية، والغساسنة تأثرت بالروم. هذه الممالك لعبت دورًا وسيطًا في التبادلات السياسية والثقافية.</p>
        <div class="controls">
          <button class="btn" data-read="6">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="6">عرض السؤال</button>
        </div>
        <div class="question" id="q6" style="display:none">
          <div class="muted">س6: أي مملكة كانت تابعة في بعض الفترات للدولة الساسانية؟</div>
          <div class="opts">
            <div class="opt">الأنباط</div>
            <div class="opt" data-correct="true">الحيرة</div>
            <div class="opt">سبأ</div>
          </div>
        </div>
      </article>

      <!-- Paragraph 7 -->
      <article class="card" id="para7">
        <div class="paragraph-title"><div class="num-badge">7</div><h3>مظاهر الحضارة في شبه الجزيرة قبل الإسلام</h3></div>
        <p>المظاهر: الحياة السياسية (قبلي وشبه ملكي)، الحياة الدينية (تعدد الأديان والعبادات الوضعية وبعض الديانات السماوية)، الاقتصادية (الرعي،الزراعة،التجارة)، الحياة الفكرية والعلمية (أدب،طب،فلك،هندسة)، والفنون والعمارة (نحت،قلاع،معابد،قصور).</p>
        <div class="controls">
          <button class="btn" data-read="7">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="7">عرض السؤال</button>
        </div>
        <div class="question" id="q7" style="display:none">
          <div class="muted">س7: ما الذي لا يندرج ضمن مظاهر الحضارة في شبه الجزيرة؟</div>
          <div class="opts">
            <div class="opt">الرعي والتجارة</div>
            <div class="opt" data-correct="true">الصناعة الثقيلة الحديثة</div>
            <div class="opt">الفنون والعمارة</div>
          </div>
        </div>
      </article>

      <!-- Paragraph 8 -->
      <article class="card" id="para8">
        <div class="paragraph-title"><div class="num-badge">8</div><h3>الفرق بين النظام القبلي والشبه الملكي</h3></div>
        <p>النظام القبلي: القبيلة هي الوحدة السياسية، تقوم على العرف والتقاليد، وترابط الدم. الشبه الملكي: اتخذ شكل ملكي في ممالك مثل اليمن والغساسنة والحيرة مع مؤسسات ملكية، مجالس، وحكام إقليميين.</p>
        <div class="controls">
          <button class="btn" data-read="8">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="8">عرض السؤال</button>
        </div>
        <div class="question" id="q8" style="display:none">
          <div class="muted">س8: أي خاصية تميز النظام القبلي؟</div>
          <div class="opts">
            <div class="opt" data-correct="true">الالتزام بعرف القبيلة ورباط الدم</div>
            <div class="opt">وجود مجلس عام تابع للملك</div>
            <div class="opt">حكم وراثي مركزي فقط</div>
          </div>
        </div>
      </article>

      <!-- Paragraph 9 -->
      <article class="card" id="para9">
        <div class="paragraph-title"><div class="num-badge">9</div><h3>الحياة الدينية قبل الإسلام</h3></div>
        <p>الديانات: تنوعت بين عبادة الأصنام والآلهة الوضعية، ووجود طوائف حافظت على التوحيد الحنيف، ووجود اليهودية في بعض المناطق مثل خيبر وضمن يثرب، وانتشار النصرانية في بعض مناطق الشام والحيرة، وانتشار طقوس صابئية في بعض المناطق.</p>
        <div class="controls">
          <button class="btn" data-read="9">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="9">عرض السؤال</button>
        </div>
        <div class="question" id="q9" style="display:none">
          <div class="muted">س9: أي ديانة كانت موجودة ضمن سكان بعض أجزاء يثرب وخيبر؟</div>
          <div class="opts">
            <div class="opt">النصرانية</div>
            <div class="opt" data-correct="true">اليهودية</div>
            <div class="opt">الزابية</div>
          </div>
        </div>
      </article>

      <!-- Paragraph 10 -->
      <article class="card" id="para10">
        <div class="paragraph-title"><div class="num-badge">10</div><h3>الحياة الاقتصادية</h3></div>
        <p>الزراعة: اقتصرت على اليمن وشمال بادية الشام ومناطق الآبار. الرعي: شغل البدو بتربية الإبل والأغنام. التجارة: ازدهرت بسبب الطرق البحرية والبرية وموقع شبه الجزيرة كحلقة وصل. الصناعات: محدودة لكنها تشمل الفخار، السيوف، والحلي.</p>
        <div class="controls">
          <button class="btn" data-read="10">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="10">عرض السؤال</button>
        </div>
        <div class="question" id="q10" style="display:none">
          <div class="muted">س10: أي من هذه الحرف كانت منتشرة في شبه الجزيرة قبل الإسلام؟</div>
          <div class="opts">
            <div class="opt">الإلكترونيات</div>
            <div class="opt" data-correct="true">الفخار والسيوف</div>
            <div class="opt">الطباعة الحديثة</div>
          </div>
        </div>
      </article>

      <!-- Paragraph 11 -->
      <article class="card" id="para11">
        <div class="paragraph-title"><div class="num-badge">11</div><h3>الحياة الفكرية والعلمية</h3></div>
        <p>الآداب: ازدهر الشعر والخطابة في الأسواق. العلوم: تطورت بعض مجالات مثل الطب (أطباء مشهورون مثل الحارث بن كلدة)، الفلك، الأنواء (مواعيد الرياح والمطر)، والهندسة (بناء السدود مثل مأرب).</p>
        <div class="controls">
          <button class="btn" data-read="11">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="11">عرض السؤال</button>
        </div>
        <div class="question" id="q11" style="display:none">
          <div class="muted">س11: أي مجال علمي ارتبط ببناء السدود مثل مأرب؟</div>
          <div class="opts">
            <div class="opt" data-correct="true">الهندسة</div>
            <div class="opt">الطب</div>
            <div class="opt">الأدب</div>
          </div>
        </div>
      </article>

      <!-- Paragraph 12 -->
      <article class="card" id="para12">
        <div class="paragraph-title"><div class="num-badge">12</div><h3>الفنون والعمارة</h3></div>
        <p>الفنون: النحت (مثل مدينة الحجر لدى الأنباط)، بناء القلاع والحصون، المعابد والكنائس في بعض المناطق، والقصور الملكية مثل قصر غمدان في صنعاء وقصر الخورنق في الحيرة.</p>
        <div class="controls">
          <button class="btn" data-read="12">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="12">عرض السؤال</button>
        </div>
        <div class="question" id="q12" style="display:none">
          <div class="muted">س12: أي مدينة اشتهرت بالنحت وبيوت منحوتة في الجبال؟</div>
          <div class="opts">
            <div class="opt" data-correct="true">الحِجر (مدائن صالح)</div>
            <div class="opt">مأرب</div>
            <div class="opt">يثرب</div>
          </div>
        </div>
      </article>

      <!-- Paragraph 13 -->
      <article class="card" id="para13">
        <div class="paragraph-title"><div class="num-badge">13</div><h3>الحياة الاجتماعية</h3></div>
        <p>الطبقات: انقسم المجتمع إلى طبقات حسب الوضع الاقتصادي والمكانة. السكن: البدو في الخيام، الحضر في بيوت من الحجارة. العادات: تضمنت جوانب إيجابية مثل الكرم والوفاء، وجوانب سلبية مثل العصبية القبلية وأحيانًا وأد البنات.</p>
        <div class="controls">
          <button class="btn" data-read="13">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="13">عرض السؤال</button>
        </div>
        <div class="question" id="q13" style="display:none">
          <div class="muted">س13: أي من العادات التالية كانت من الجوانب الإيجابية؟</div>
          <div class="opts">
            <div class="opt" data-correct="true">الكرم</div>
            <div class="opt">الاغارة على طرق القوافل</div>
            <div class="opt">وأد البنات</div>
          </div>
        </div>
      </article>

      <!-- Paragraph 14 -->
      <article class="card" id="para14">
        <div class="paragraph-title"><div class="num-badge">14</div><h3>دور المرأة قبل الإسلام</h3></div>
        <p>كان للمرأة أدوار متعددة: غزل الصوف، رعاية الأسرة، ومشاركة أحيانًا في الحروب (تضميد الجرحى، الإمداد). بعض النساء شغلن مواقع سياسية وتجارية مثل بلقيس وكنه المرأة خديجة كانت تاجرة ناجحة.</p>
        <div class="controls">
          <button class="btn" data-read="14">قرأتها — +10 XP</button>
          <button class="btn ghost" data-toggle-q="14">عرض السؤال</button>
        </div>
        <div class="question" id="q14" style="display:none">
          <div class="muted">س14: أي من هذه النساء ورد ذكرها في نص الدرس كمثلة للقوة الاقتصادية؟</div>
          <div class="opts">
            <div class="opt" data-correct="true">خديجة (تاجرة)</div>
            <div class="opt">بلقيس فقط</div>
            <div class="opt">لا أسماء</div>
          </div>
        </div>
      </article>

    </main>

  </div>

  <script>
    // state
    const XP_PER_READ = 10;
    const XP_PER_CORRECT = 20;
    const LEVEL_THRESHOLDS = [0,150,350,700]; // XP thresholds for levels
    let state = JSON.parse(localStorage.getItem('lesson_state')||'{}');
    if(!state.xp) state.xp = 0; if(!state.read) state.read = {};

    const xpCount = document.getElementById('xpCount');
    const xpFill = document.getElementById('xpFill');
    const xpNext = document.getElementById('xpNext');
    const levelBadge = document.getElementById('levelBadge');

    function updateXP(){
      xpCount.textContent = state.xp;
      // next level
      let next = LEVEL_THRESHOLDS.find(t=>t>state.xp) || LEVEL_THRESHOLDS[LEVEL_THRESHOLDS.length-1];
      xpNext.textContent = next;
      const pct = Math.min(100, Math.round(state.xp/next*100));
      xpFill.style.width = pct + '%';
      // level label
      let lvl = LEVEL_THRESHOLDS.filter(t=>t<=state.xp).length;
      const names = ['مبتدئ','مستكشف','محارب علمي','سفير التاريخ'];
      levelBadge.textContent = 'المستوى: ' + (names[Math.max(0,lvl-1)] || names[names.length-1]);
      localStorage.setItem('lesson_state', JSON.stringify(state));
    }
    updateXP();

    // read buttons
    document.querySelectorAll('[data-read]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-read');
        if(state.read[id]){ flash('+0 XP', btn); return; }
        state.read[id] = true; state.xp += XP_PER_READ; updateXP(); flash('+'+XP_PER_READ+' XP', btn); btn.textContent='مقروء ✓'; btn.disabled=true; btn.style.opacity=0.8;
      });
    });

    // toggle question
    document.querySelectorAll('[data-toggle-q]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-toggle-q');
        const q = document.getElementById('q'+id);
        if(q.style.display==='none' || q.style.display==='') q.style.display='block'; else q.style.display='none';
      });
    });

    // options
    document.querySelectorAll('.question').forEach(q=>{
      q.querySelectorAll('.opt').forEach(opt=>{
        opt.addEventListener('click', ()=>{
          // disable further clicks
          if(opt.parentElement.dataset.answered==='true') return;
          const correct = opt.getAttribute('data-correct') === 'true';
          opt.parentElement.dataset.answered = 'true';
          if(correct){
            opt.classList.add('correct');
            state.xp += XP_PER_CORRECT; updateXP(); flash('+'+XP_PER_CORRECT+' XP', opt);
            // confetti
            spawnConfetti(opt);
          } else {
            opt.classList.add('wrong');
            flash('-0 XP', opt);
          }
          // reveal correct option outline
          opt.parentElement.querySelectorAll('.opt').forEach(o=>{ if(o.getAttribute('data-correct')==='true') o.classList.add('correct'); });
        });
      });
    });

    // flash animation for XP
    function flash(text, el){
      const t = document.createElement('div'); t.textContent = text; t.style.position='absolute'; t.style.background='linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02))'; t.style.padding='6px 10px'; t.style.borderRadius='8px'; t.style.color='white'; t.style.fontWeight='700'; t.style.zIndex=9999;
      const rect = el.getBoundingClientRect(); t.style.left = (rect.left + window.scrollX + rect.width/2 - 30) + 'px'; t.style.top = (rect.top + window.scrollY - 28) + 'px'; document.body.appendChild(t);
      t.animate([{opacity:0, transform:'translateY(6px)'},{opacity:1, transform:'translateY(0)'},{opacity:0, transform:'translateY(-18px)'}],{duration:1400}).onfinish = ()=>document.body.removeChild(t);
    }

    // simple confetti
    function spawnConfetti(el){
      for(let i=0;i<20;i++){
        const p = document.createElement('div'); p.className='confetti-piece'; p.style.width='8px'; p.style.height='12px'; p.style.background=['#8b5cf6','#6d28d9','#7ef08b','#fbbf24'][Math.floor(Math.random()*4)]; p.style.left=(el.getBoundingClientRect().left + window.scrollX + el.offsetWidth/2) + 'px'; p.style.top=(el.getBoundingClientRect().top + window.scrollY) + 'px'; p.style.opacity=0.95; p.style.transform='rotate('+Math.random()*360+'deg)'; document.body.appendChild(p);
        const dx = (Math.random()-0.5)*200; const dy = -100 - Math.random()*200; p.animate([{transform:'translate(0,0) rotate(0)'},{transform:`translate(${dx}px,${dy}px) rotate(${Math.random()*720}deg)`}],{duration:1000+Math.random()*800}).onfinish = ()=>p.remove();
      }
    }

    // helper to show first unread paragraph on load
    document.addEventListener('DOMContentLoaded', ()=>{
      const firstUnread = [...document.querySelectorAll('[data-read]')].find(b=>!state.read[b.getAttribute('data-read')]);
      if(firstUnread){ firstUnread.scrollIntoView({behavior:'smooth',block:'center'}); }
    });

  </script>
</body>
</html>
