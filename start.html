<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Main Page</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
  --color1: #ff6f61;
  --color2: #6a11cb;
  --color3: #2575fc;
  --text-color: white;
}

body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  background: linear-gradient(270deg, var(--color1), var(--color2), var(--color3));
  background-size: 600% 600%;
  animation: gradientBG 15s ease infinite;
  color: var(--text-color);
  scroll-behavior: smooth;
}

/* ===== Header ===== */
header {
  width: 96%;
  background-color: #000000c0;
  padding: 15px 30px;
  position: sticky;
  top: 0;
  z-index: 1000;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  border-bottom: 2px solid #ff6f61;
}
header nav a{
  text-decoration: none;
  color: rgba(255,255,255,0.8);
  font-weight: 600;
  font-size: 16px;
  margin-right: 20px;
  position: relative;
}
header nav a::after{
  content:"";
  position:absolute;
  bottom:-5px;
  left:0;
  width:0;
  height:2px;
  background:#ff6f61;
  transition: width 0.3s ease;
}
header nav a:hover::after{ width:100%; }

.theme-toggle{
  background: #ff6f61;
  border: none;
  width: 45px;
  height: 45px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  transition: transform 0.2s;
}
.theme-toggle:hover { transform: scale(1.1); }

/* ===== Hero ===== */
.hero{
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  height:100vh;
  text-align:center;
  gap:20px;
}
.start-btn{
  background: var(--color1);
  border:none;
  padding: 20px 50px;
  border-radius: 15px;
  font-size:24px;
  font-weight:700;
  cursor:pointer;
  color:white;
  transition: transform 0.2s, background 0.3s;
}
.start-btn:hover{ transform:scale(1.05); background:#ff3b2e; }

/* ===== Content Sections ===== */
.content{
  display:flex;
  flex-direction:column;
  gap:50px;
  padding:50px 20px;
}
.section-item{
  display:flex;
  align-items:center;
  gap:20px;
  background: rgba(255,255,255,0.1);
  padding:20px 30px;
  border-radius:15px;
  transition: transform 0.3s, box-shadow 0.3s;
}
.section-item:hover{
  transform: translateY(-10px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}
.section-item i{
  font-size:50px;
  color:goldenrod;
  min-width:60px;
  text-align:center;
}
.section-item div{ flex:1; }
.section-item h2{ margin-bottom:10px; }
.section-item p{ font-size:16px; margin-bottom:10px; }
.enter-btn{
  padding:10px 25px;
  border:none;
  border-radius:10px;
  background:#6a11cb;
  color:white;
  font-weight:600;
  cursor:pointer;
  transition: transform 0.2s, background 0.3s;
}
.enter-btn:hover{ transform:scale(1.05); background:#2575fc; }

/* ===== Timer ===== */
#expiryTimer {
  margin-top: 10px;
  font-size: 14px;
  font-weight: bold;
  color: #ffd700;
}

/* ===== Modal ===== */
#subscribeModal {
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:#000000b0;
  justify-content:center;
  align-items:center;
  z-index:2000;
}
.modal-content {
  background: linear-gradient(135deg, var(--color2), var(--color3));
  color: #fff;
  padding: 30px;
  border-radius: 20px;
  width: 320px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0,0,0,0.4);
  animation: popIn 0.4s ease;
}
.modal-content h3 {
  margin-bottom: 20px;
  font-size: 22px;
}
.modal-btn {
  width: 100%;
  margin: 8px 0;
  padding: 12px;
  font-size: 16px;
  border-radius: 12px;
  border: none;
  font-weight: bold;
  cursor: pointer;
  background: var(--color1);
  color:#fff;
  transition: transform 0.2s, background 0.3s;
}
.modal-btn:hover { transform:scale(1.05); background:#ff3b2e; }
.close-btn {
  margin-top: 10px;
  background:#444;
}
.close-btn:hover { background:#222; }

@keyframes popIn {
  from { transform: scale(0.7); opacity:0; }
  to { transform: scale(1); opacity:1; }
}

/* ===== Footer ===== */
footer{
  background:#000000c0;
  text-align:center;
  padding:20px;
  font-size:16px;
  border-top:2px solid #ff6f61;
}
footer a{ color:#ff6f61; text-decoration:none; font-weight:bold; }
footer a:hover{ text-decoration:underline; }

body.dark-theme{
  --color1:#000000;
  --color2:#252323;
  --color3:#3a3a3a;
  --text-color:#eee;
}
@keyframes gradientBG{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
</style>
</head>
<body>

<header>
  <nav>
    <a href="to-do.html">To Do List</a>
    <a href="quiz1-start.html">Quiz</a>
    <a href="student.html">Learning</a>
    <a href="timer.html">Study Timer</a>
    <a href="community.html">Community</a>
    <a href="note.html">Note</a>
    <a href="feedback.html">FeedBack Box</a>
  </nav>

  <div style="color:white; font-weight:600; margin-right:20px;">
    الرصيد: <span id="balance">0</span> ج
  </div>
  <button class="theme-toggle"><i class="fas fa-sun"></i></button>
</header>

<section class="hero">
  <h1>Welcome to Your Study Platform</h1>
  <button class="start-btn">START</button>
</section>

<section class="content">
  <div id="todo" class="section-item">
    <i class="fas fa-list-check"></i>
    <div>
      <h2>To Do List</h2>
      <p>Organize your daily tasks efficiently.</p>
      <a href="to-do.html"><button class="enter-btn">ENTER</button></a>
    </div>
  </div>

  <!-- Learning Content -->
  <div id="learning" class="section-item">
    <i class="fas fa-book"></i>
    <div>
      <h2>Learning Content</h2>
      <p>Access lessons and tutorials.</p>
      <div id="learning-locked">
        <button id="subscribeBtn" class="enter-btn">اشترك</button>
      </div>
      <div id="learning-unlocked" style="display:none;">
        <a href="student.html"><button class="enter-btn">ENTER</button></a>
        <div id="expiryTimer"></div>
      </div>
    </div>
  </div>
</section>

<footer>
  Follow us on <a href="https://www.instagram.com/7oda__807" target="_blank"><i class="fab fa-instagram"></i> Instagram</a>
</footer>

<!-- Modal -->
<div id="subscribeModal">
  <div class="modal-content">
    <h3>اختر الباقة</h3>
    <button class="modal-btn" onclick="subscribe(10,1)">10ج / أسبوع</button>
    <button class="modal-btn" onclick="subscribe(20,14)">20ج / أسبوعين</button>
    <button class="modal-btn" onclick="subscribe(50,30)">50ج / شهر</button>
    <button class="modal-btn close-btn" onclick="closeModal()">إلغاء</button>
  </div>
</div>

<script>
// START scroll
document.querySelector('.start-btn').addEventListener('click',()=>{
  document.querySelector('.content').scrollIntoView({behavior:'smooth'});
});

// Theme toggle
const themeBtn = document.querySelector('.theme-toggle');
themeBtn.addEventListener('click',()=>{
  document.body.classList.toggle('dark-theme');
  localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
});
if(localStorage.getItem('theme')==='dark'){ document.body.classList.add('dark-theme'); }

// Modal
const subscribeBtn = document.getElementById("subscribeBtn");
const subscribeModal = document.getElementById("subscribeModal");
const lockedDiv = document.getElementById("learning-locked");
const unlockedDiv = document.getElementById("learning-unlocked");
const expiryTimer = document.getElementById("expiryTimer");

function closeModal(){ subscribeModal.style.display = "none"; }
subscribeBtn.addEventListener("click", ()=>{ subscribeModal.style.display = "flex"; });

// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDnXtTg9iLLm_b9zyKBxr0v8aGhXJuR3WE",
  authDomain: "my-web-c23de.firebaseapp.com",
  projectId: "my-web-c23de",
  storageBucket: "my-web-c23de.appspot.com",
  messagingSenderId: "846339445873",
  appId: "1:846339445873:web:fc0427a7ad77eceda837d0",
  measurementId: "G-3SE0GBRS8C"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

function subscribe(price, days){
  const user = auth.currentUser;
  if(!user) return;
  db.collection("users").doc(user.uid).get().then(doc=>{
    if(doc.exists){
      let balance = doc.data().balance ?? 0;
      if(balance >= price){
        let now = new Date();
        let expiry = new Date();
        expiry.setDate(now.getMinutes() + days);
        db.collection("users").doc(user.uid).update({
          balance: balance - price,
          learningAccess: {
            start: firebase.firestore.Timestamp.fromDate(now),
            expiry: firebase.firestore.Timestamp.fromDate(expiry)
          }
        }).then(()=>{
          alert("تم الاشتراك بنجاح ✅");
          closeModal();
          checkLearningAccess();
        });
      } else { alert("رصيدك غير كافي ❌"); }
    }
  });
}

function updateTimer(expiryDate){
  function tick(){
    let now = new Date();
    let diff = expiryDate - now;
    if(diff <= 0){
      expiryTimer.innerText = "انتهى الاشتراك ⛔";
      lockedDiv.style.display = "block";
      unlockedDiv.style.display = "none";
      clearInterval(timerInterval);
      return;
    }
    let days = Math.floor(diff / (1000*60*60*24));
    let hours = Math.floor((diff % (1000*60*60*24))/(1000*60*60));
    let minutes = Math.floor((diff % (1000*60*60))/(1000*60));
    expiryTimer.innerText = `متبقي: ${days} يوم ${hours} س ${minutes} د`;
  }
  tick();
  let timerInterval = setInterval(tick,60000); // يحدث كل دقيقة
}

function checkLearningAccess(){
  const user = auth.currentUser;
  if(!user) return;
  db.collection("users").doc(user.uid).onSnapshot(doc=>{
    if(doc.exists){
      const data = doc.data();
      document.getElementById("balance").innerText = data.balance ?? 0;
      if(data.learningAccess){
        const expiry = data.learningAccess.expiry.toDate();
        if(new Date() < expiry){
          lockedDiv.style.display = "none";
          unlockedDiv.style.display = "block";
          updateTimer(expiry);
        } else {
          lockedDiv.style.display = "block";
          unlockedDiv.style.display = "none";
        }
      } else {
        lockedDiv.style.display = "block";
        unlockedDiv.style.display = "none";
      }
    }
  });
}

auth.onAuthStateChanged((user)=>{
  if(user){ checkLearningAccess(); }
  else{ window.location.href = "index.html"; }
});
</script>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</body>
</html>
