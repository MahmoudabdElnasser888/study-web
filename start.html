<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Main Page</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
  --color1: #ff6f61;
  --color2: #6a11cb;
  --color3: #2575fc;
  --text-color: white;
}
body {
  font-family: 'Poppins', sans-serif;
  margin: 0;
  background: linear-gradient(270deg, var(--color1), var(--color2), var(--color3));
  background-size: 600% 600%;
  animation: gradientBG 15s ease infinite;
  color: var(--text-color);
  scroll-behavior: smooth;
}
header { 
  width: 96%; 
  background-color: #000000c0; 
  padding: 15px 30px; 
  position: sticky; 
  top: 0; 
  z-index: 1000; 
  display: flex; 
  justify-content: center; 
  align-items: center; 
  box-shadow: 0 4px 8px rgba(0,0,0,0.4); 
  border-bottom: 2px solid #ff6f61; 
}
.rased {
  color: #fff;
  font-weight: bold;
  background: linear-gradient(120deg, #ff6f61, #ff3b2e);
  border-radius: 30px;
  padding: 6px 14px;
  box-shadow: 0 3px 10px rgba(0,0,0,0.3);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  cursor: pointer;
  font-size: 15px;
  text-decoration: none;
}
.rased:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 16px rgba(0,0,0,0.4);
}
.header-right {
  display: flex;
  align-items: center;
  gap: 20px;
}
#subscription-status {
  font-weight: 600;
  font-size: 15px;
  color: #f9f9f9;
  background: rgba(0,0,0,0.25);
  padding: 6px 12px;
  border-radius: 8px;
}
.theme-toggle {
  background: #fff;
  color: #2575fc;
  border: none;
  width: 42px;
  height: 42px;
  border-radius: 50%;
  cursor: pointer;
  font-size: 18px;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 3px 8px rgba(0,0,0,0.25);
  transition: all 0.25s ease;
}
.theme-toggle:hover {
  transform: rotate(15deg) scale(1.1);
  background: #f0f0f0;
}
.hero{
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  height:100vh;
  text-align:center;
  gap:20px;
}
.start-btn{
  background: var(--color1);
  border:none;
  padding: 20px 50px;
  border-radius: 15px;
  font-size:24px;
  font-weight:700;
  cursor:pointer;
  color:white;
  transition: transform 0.2s, background 0.3s;
}
.start-btn:hover{ transform:scale(1.05); background:#ff3b2e; }
.content{
  display:flex;
  flex-direction:column;
  gap:50px;
  padding:50px 20px;
}
.section-item{
  display:flex;
  align-items:center;
  gap:20px;
  background: rgba(255,255,255,0.1);
  padding:20px 30px;
  border-radius:15px;
  transition: transform 0.3s, box-shadow 0.3s;
  position: relative;
}
.section-item:hover{
  transform: translateY(-10px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}
.section-item i{
  font-size:50px;
  color:goldenrod;
  min-width:60px;
  text-align:center;
}
.section-item div{
  flex:1;
}
.section-item h2{ margin-bottom:10px; }
.section-item p{ font-size:16px; margin-bottom:10px; }
.enter-btn{
  padding:10px 25px;
  border:none;
  border-radius:10px;
  background:#6a11cb;
  color:white;
  font-weight:600;
  cursor:pointer;
  transition: transform 0.2s, background 0.3s;
}
.enter-btn:hover{
  transform:scale(1.05);
  background:#2575fc;
}
.section-item.locked { opacity: 0.85; filter: saturate(0.9); }
.lock-overlay {
  position:absolute;
  right:20px;
  top:20px;
  background:rgba(0,0,0,0.6);
  padding:6px 10px;
  border-radius:8px;
  display:flex;
  gap:8px;
  align-items:center;
  font-weight:600;
  color:#fff;
}
.soon-tag {
  display: inline-block;
  background: #ff6f61;
  color: white;
  font-weight: 700;
  padding: 6px 14px;
  border-radius: 20px;
  margin-top: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  animation: pulse 1.5s infinite;
}
@keyframes pulse {
  0% { transform: scale(1); opacity: 0.9; }
  50% { transform: scale(1.08); opacity: 1; }
  100% { transform: scale(1); opacity: 0.9; }
}
footer{
  background:#000000c0;
  text-align:center;
  padding:20px;
  font-size:16px;
  border-top:2px solid #ff6f61;
}
footer a{ color:#ff6f61; text-decoration:none; font-weight:bold; }
footer a:hover{ text-decoration:underline; }
.hidden-link {
  font-size: 10px; 
  color: rgba(255, 255, 255, 0.37); 
  padding-left: 16px;
}
body.dark-theme{
  --color1:#000000;
  --color2:#252323;
  --color3:#3a3a3a;
  --text-color:#eee;
}
@keyframes gradientBG{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
</style>
</head>
<body>

<header>
  <div class="header-right">
    <a href="pay.html" class="rased"> الرصيد: <span id="balance">0</span> ج </a>
    <div id="subscription-status"></div>
    <button class="theme-toggle"><i class="fas fa-sun"></i></button>
  </div>
</header>

<section class="hero">
  <h1>Welcome to Your Study Platform</h1>
  <button class="start-btn">START</button>
</section>

<section class="content">
  <!-- Championship -->
  <div id="championship" class="section-item locked">
    <i class="fa-solid fa-trophy"></i>
    <div>
      <h2>Championship</h2>
      <p>انضم للبطولة ونافس زملاءك</p>
      <button id="championship-enter" class="enter-btn">ENTER</button>
    </div>
    <div class="lock-overlay" id="championship-overlay"><i class="fas fa-lock"></i> مُقفل — اشترك</div>
  </div>
</section>

<footer>
  Follow us on <a href="https://www.instagram.com/7oda__807" target="_blank"><i class="fab fa-instagram"></i> Instagram</a>
  <a href="the-admin.com" target="_blank" class="hidden-link">ADMIN</a>
</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
  const firebaseConfig = { 
    apiKey: "AIzaSyDnXtTg9iLLm_b9zyKBxr0v8aGhXJuR3WE",
    authDomain: "my-web-c23de.firebaseapp.com",
    projectId: "my-web-c23de",
    storageBucket: "my-web-c23de.appspot.com",
    messagingSenderId: "846339445873",
    appId: "1:846339445873:web:fc0427a7ad77eceda837d0",
    measurementId: "G-3SE0GBRS8C"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const balanceSpan = document.getElementById('balance');
  const subStatus = document.getElementById('subscription-status');
  const champItem = document.getElementById('championship');
  const champOverlay = document.getElementById('championship-overlay');
  const champBtn = document.getElementById('championship-enter');

  let currentUser = null;

  function updateUIFromUserData(data) {
    const balance = Number(data.balance ?? 0);
    balanceSpan.innerText = Math.max(0, balance);

    const sub = data.subscription;
    const now = Date.now();
    let active = false;
    let remainingMs = 0;
    if(sub && sub.expiresAt) {
      const expiresAtMillis = sub.expiresAt.toMillis ? sub.expiresAt.toMillis() : (sub.expiresAt.seconds*1000);
      remainingMs = expiresAtMillis - now;
      active = remainingMs > 0;
    }
    if(active){
      champItem.classList.remove('locked');
      champOverlay.style.display='none';
      champBtn.outerHTML = `<div class="soon-tag">SOON</div><br><a href="https://wa.me/201116973865" target="_blank"><button class="enter-btn">اشترك في البطولة</button></a>`;
      const days = Math.floor(remainingMs / (24*3600*1000));
      const hours = Math.floor((remainingMs % (24*3600*1000)) / (3600*1000));
      subStatus.innerText = `متبقي ${days} يوم ${hours} ساعة`;
    } else {
      champItem.classList.add('locked');
      champOverlay.style.display='flex';
      subStatus.innerText = `غير مشترك`;
    }
  }

  auth.onAuthStateChanged(async (user)=>{
    if(user){
      currentUser=user;
      const docRef=db.collection("users").doc(user.uid);
      const docSnap=await docRef.get();
      if(docSnap.exists){
        updateUIFromUserData(docSnap.data());
        docRef.onSnapshot(snap=>updateUIFromUserData(snap.data()));
      } else {
        await docRef.set({balance:0, subscription:null});
      }
    } else {
      window.location.href="signup.html";
    }
  });

  document.querySelector('.theme-toggle').addEventListener('click', ()=>{
    document.body.classList.toggle('dark-theme');
    const icon=document.querySelector('.theme-toggle i');
    if(document.body.classList.contains('dark-theme')){
      icon.classList.remove('fa-sun');
      icon.classList.add('fa-moon');
    } else {
      icon.classList.remove('fa-moon');
      icon.classList.add('fa-sun');
    }
  });
</script>
</body>
</html>
