<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø§Ù…ØªØ­Ø§Ù† Ù…Ø¨Ø§Ø´Ø±</title>
  <script type="module">
    // âœ… Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBsKneiM3AcbpWUzJtdZ-yDtp__8JbCN7Y",
      authDomain: "codeaccessproject-82614.firebaseapp.com",
      projectId: "codeaccessproject-82614",
      storageBucket: "codeaccessproject-82614.firebasestorage.app",
      messagingSenderId: "522691348426",
      appId: "1:522691348426:web:76f17fb8ec91b3ca47f133",
      measurementId: "G-W46X7GM6CS"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.addEventListener("DOMContentLoaded", () => {
      const loginBox = document.getElementById("login-box");
      const examBox = document.getElementById("exam-box");
      const codeInput = document.getElementById("code-input");
      const emailInput = document.getElementById("email-input");
      const loginBtn = document.getElementById("login-btn");
      const submitBtn = document.getElementById("submit-btn");
      const studentInfo = document.getElementById("student-info");
      const questionsContainer = document.getElementById("questions-container");

      // ğŸ“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (ØµÙˆØ±Ø© + Ø§Ø®ØªÙŠØ§Ø±Ø§Øª)
      const questions = [
        {
          img: "q1.jpg",
          options: ["Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 1", "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 2", "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 3", "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 4"]
        },
        {
          img: "q2.jpg",
          options: ["A", "B", "C", "D"]
        }
      ];

      loginBtn.addEventListener("click", async () => {
        const code = codeInput.value.trim();
        const email = emailInput.value.trim();
        if (!code || !email) {
          alert("âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ");
          return;
        }

        const userRef = doc(db, "users", code);
        const userSnap = await getDoc(userRef);

        if (!userSnap.exists()) {
          alert("âŒ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­");
          return;
        }

        const data = userSnap.data();
        if (data.used === true) {
          alert("âš ï¸ Ø§Ù„ÙƒÙˆØ¯ ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ù† Ù‚Ø¨Ù„");
          return;
        }

        // âœ… Ù„Ùˆ Ø§Ù„ÙƒÙˆØ¯ ØµØ­ÙŠØ­ ÙˆÙ…Ø´ Ù…Ø³ØªØ®Ø¯Ù… â†’ ÙŠØ­Ø¯Ø« used ÙˆÙŠØ¯Ø®Ù„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†
        await updateDoc(userRef, { used: true, email: email });

        studentInfo.textContent = `Ø§Ù„ÙƒÙˆØ¯: ${code} | ${email}`;
        loginBox.classList.add("hidden");
        examBox.classList.remove("hidden");

        renderQuestions();
      });

      // Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
      function renderQuestions() {
        questionsContainer.innerHTML = "";
        questions.forEach((q, index) => {
          const qDiv = document.createElement("div");
          qDiv.className = "question";

          const img = document.createElement("img");
          img.src = q.img;
          img.alt = `Ø³Ø¤Ø§Ù„ ${index + 1}`;

          const optionsDiv = document.createElement("div");
          optionsDiv.className = "answers";

          q.options.forEach((opt, optIndex) => {
            const id = `q${index}-opt${optIndex}`;
            const label = document.createElement("label");
            label.innerHTML = `<input type="radio" name="q${index}" value="${opt}"> ${opt}`;
            optionsDiv.appendChild(label);
          });

          qDiv.appendChild(img);
          qDiv.appendChild(optionsDiv);
          questionsContainer.appendChild(qDiv);
        });
      }

      // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª
      submitBtn.addEventListener("click", () => {
        const answers = [];
        let allAnswered = true;

        questions.forEach((_, index) => {
          const selected = document.querySelector(`input[name="q${index}"]:checked`);
          if (selected) {
            answers.push(selected.value);
          } else {
            allAnswered = false;
          }
        });

        if (!allAnswered) {
          alert("âš ï¸ Ø¬Ø§ÙˆØ¨ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");
          return;
        }

        console.log("Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª:", answers);
        alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­");
        // Ù‡Ù†Ø§ ØªÙ‚Ø¯Ø± ØªØ¨Ø¹Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ù„Ù€ Firestore Ù„Ùˆ Ø¹Ø§ÙŠØ²
      });
    });
  </script>

  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    #login-box, #exam-box {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      max-width: 450px;
      width: 100%;
      text-align: center;
    }
    .hidden { display: none; }
    img {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .answers {
      text-align: right;
      margin-bottom: 15px;
    }
    .answers label {
      display: block;
      margin: 5px 0;
      cursor: pointer;
    }
    button {
      padding: 10px 15px;
      background: black;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #333;
    }
    .question {
      margin-bottom: 25px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 15px;
    }
  </style>
</head>
<body>

  <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="login-box">
    <h2>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</h2>
    <input type="text" id="code-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯"><br><br>
    <input type="email" id="email-input" placeholder="Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"><br><br>
    <button id="login-btn">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <!-- Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† -->
  <div id="exam-box" class="hidden">
    <div id="student-info" style="margin-bottom:10px;font-weight:bold;"></div>

    <div id="questions-container"></div>

    <button id="submit-btn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</button>
  </div>

</body>
</html>
