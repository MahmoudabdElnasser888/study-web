<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Unit 2 — Past Perfect & Third Conditional</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#5c5959;
      --panel:#0f0f0f;
      --gold:rgb(132, 89, 189);
      --muted:#ffffff;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Cairo',sans-serif;
      background:linear-gradient(135deg,var(--bg),#080808);
      color:#fff;
      padding:18px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      direction:rtl;
    }

    header{ text-align:center; margin-bottom:12px }
    h1{ color:var(--gold); margin:6px 0; font-size:22px; letter-spacing:0.6px; text-shadow:0 0 10px rgba(218,165,32,0.12) }
    p.lead{ color:var(--muted); margin:6px 0 16px; font-size:14px }

    .container{ max-width:1100px; margin:0 auto; }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:14px;
      margin-bottom:16px;
      border:1px solid rgba(218,165,32,0.06);
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }

    /* image gallery */
    .images{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
      align-items:start;
    }
    .img-wrap{
      background:#070707;
      padding:8px;
      border-radius:10px;
      overflow:hidden;
      border:1px solid var(--glass);
    }
    .img-wrap img{
      width:100%;
      height:auto;
      display:block;
      border-radius:6px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
      touch-action: manipulation;
    }
    .img-caption{ text-align:center; color:var(--muted); font-size:13px; margin-top:8px }

    /* content */
    .section-title{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      margin: 8px 0 10px;
    }
    .section-title h2{ margin:0; color:var(--gold); font-size:16px }
    .section-title .badge{ color:#000; background:var(--gold); padding:6px 8px; border-radius:8px; font-weight:700; font-size:13px }

    .rule{
      padding:12px;
      border-radius:10px;
      background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      border:1px solid rgba(255,255,255,0.02);
      margin-bottom:12px;
    }
    .rule h3{ margin:0 0 8px; color:#ffd87a; font-size:15px }
    .rule p{ margin:0; color:var(--muted); line-height:1.6; font-size:14px; text-align:right }

    /* examples */
    .examples{ display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:8px }
    .ex{ padding:10px; border-radius:8px; background:#0b0b0b; border:1px solid rgba(255,255,255,0.02); font-size:14px; color:#fff }

    /* quiz */
    .quiz{ margin-top:12px; }
    .question{ padding:12px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); border:1px solid rgba(255,255,255,0.02); margin-bottom:10px; }
    .question h4{ margin:0 0 8px; color:var(--gold); font-size:15px }
    .choices{ display:flex; flex-direction:column; gap:8px }
    .choice{
      padding:10px; border-radius:8px; background:#0b0b0b; border:1px solid rgba(255,255,255,0.03); cursor:pointer; text-align:right;
      transition: all .15s ease;
      user-select:none;
    }
    .choice:hover{ transform:translateY(-3px); box-shadow:0 8px 20px rgba(0,0,0,0.6) }
    .choice.selected{ outline:3px solid rgba(218,165,32,0.18); background:linear-gradient(90deg, rgba(218,165,32,0.03), rgba(218,165,32,0.01)); }
    .choice.correct{ background:linear-gradient(90deg, rgba(0,150,0,0.06), rgba(0,150,0,0.02)); border-color:rgba(0,150,0,0.2) }
    .choice.wrong{ background:linear-gradient(90deg, rgba(200,0,0,0.06), rgba(200,0,0,0.02)); border-color:rgba(200,0,0,0.2) }

    .actions{ display:flex; gap:8px; margin-top:10px; justify-content:flex-end; }
    .btn{
      background:var(--gold); color:#000; padding:10px 12px; border-radius:10px; border:0; font-weight:700; cursor:pointer;
      box-shadow:0 8px 18px rgba(218,165,32,0.12);
    }
    .btn.ghost{ background:transparent; color:var(--gold); border:1px solid rgba(218,165,32,0.14) }

    footer{ text-align:center; color:var(--muted); margin-top:18px; font-size:13px }

    /* responsive */
    @media (max-width:900px){
      .images{ grid-template-columns:1fr; }
      .examples{ grid-template-columns:1fr; }
    }

    /* popup styles kept unchanged */
.popup-zoom {
  position: fixed;
  inset: 0;
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1400;
  padding: 20px;
  transition: opacity .25s ease;
  background: linear-gradient(180deg, rgba(0,0,0,0.72), rgba(0,0,0,0.88));
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}
.popup-zoom.open { display:flex; opacity:1; }

.popup-zoom .popup-inner {
  position: relative;
  max-width: 1100px;
  width: 92%;
  max-height: 92%;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  padding: 12px;
  border-radius: 12px;
  box-shadow: 0 40px 80px rgba(0,0,0,0.7);
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.03);
}
.popup-zoom img {
  width: auto;
  height: auto;
  max-width: 100%;
  max-height: 80vh;
  border-radius: 10px;
  object-fit: contain;
  box-shadow: 0 28px 60px rgba(0,0,0,0.7), 0 0 30px rgba(218,165,32,0.08);
  transition: transform .28s cubic-bezier(.2,.9,.3,1), filter .2s ease;
  cursor: zoom-in;
  display:block;
}
.popup-zoom img.zoomed {
  transform: scale(1.15);
  cursor: zoom-out;
}
.popup-zoom .caption {
  position: absolute;
  bottom: 12px;
  left: 16px;
  right: 16px;
  color: #e6d8a0;
  font-size: 14px;
  text-align: center;
  opacity: .95;
  pointer-events: none;
}
.popup-zoom .spinner {
  width:56px;
  height:56px;
  border-radius:50%;
  border:6px solid rgba(255,255,255,0.08);
  border-top-color: rgba(218,165,32,0.95);
  animation: spin .9s linear infinite;
  position:absolute;
}
@keyframes spin { to { transform: rotate(360deg); } }
.popup-zoom .btn {
  position:absolute;
  background: rgba(0,0,0,0.45);
  border:1px solid rgba(255,255,255,0.06);
  color:#fff;
  width:44px; height:44px;
  border-radius:50%;
  display:inline-flex; align-items:center; justify-content:center;
  cursor:pointer;
  transition: transform .12s ease, background .12s ease;
  backdrop-filter: blur(4px);
}
.popup-zoom .btn:hover { transform: translateY(-3px); background: rgba(218,165,32,0.12); color:#000; }
.popup-zoom .btn.close { top:12px; right:12px; left:auto; font-size:22px; }
.popup-zoom .btn.prev { left: 8px; top: 50%; transform: translateY(-50%); width:48px; height:48px; font-size:20px; }
.popup-zoom .btn.next { right: 8px; top: 50%; transform: translateY(-50%); width:48px; height:48px; font-size:20px; }

@media (max-width:900px){
  .popup-zoom .popup-inner{ padding:8px; max-height:94vh; }
  .popup-zoom img{ max-height:74vh; }
  .popup-zoom .btn.prev { left:6px; }
  .popup-zoom .btn.next { right:6px; }
  .popup-zoom .btn.close { top:8px; right:8px; }
}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Grammar — الوحدة 2 (Past Perfect & Third Conditional)</h1>
      <p class="lead">شرح مبسّط للـ Past Perfect والحالة الشرطية الثالثة مع أمثلة وملاحظات واختبار تفاعلي.</p>
    </header>

    

    <!-- FORMATTED GRAMMAR: Past Perfect -->
    <div class="card" id="formatted">
      <div class="section-title"><h2>1. Past Perfect (التام للماضي)</h2><div class="badge">Formation</div></div>

      <div class="rule">
        <h3>التكوين (Formation)</h3>
        <p>
          تركيب الجملة الإيجابية: <strong>Subject + had + past participle (p.p.)</strong>.<br>
          مثال: <em>He had done his homework before he watched TV.</em><br>
          الجملة السلبية: <strong>Subject + hadn't + past participle</strong>.<br>
          سؤال: <strong>Had + subject + past participle?</strong>
        </p>
        <div class="examples">
          <div class="ex"><strong>He had done</strong> his homework before he watched TV. — كان قد أنهى واجبه قبل أن يشاهد التلفاز.</div>
          <div class="ex"><strong>They had had</strong> their lunch by the time we arrived. — كانوا قد تناولوا غداءهم عندما وصلنا.</div>
        </div>
      </div>

      <div class="rule">
        <h3>الاستخدام (Usage)</h3>
        <p>
          نستخدم الـ <strong>Past Perfect</strong> للحديث عن حدث حدث <em>قبل</em> حدث آخر في الماضي. أي: "فعلة أ" حدثت ثم "فعلة ب" — نضع الأولى في Past Perfect.
        </p>
        <p>
          كلمات ربط شائعة: <strong>after, before, by the time, as soon as, until, when</strong>.<br>
          مثال: <em>I went to the cinema after I had completed my work.</em> — ذهبت إلى السينما بعدما أنهيت عملي.
        </p>
      </div>

      <div class="rule">
        <h3>ملاحظات / Passive و Past Participle</h3>
        <p>
          التصريف الثالث (past participle) ضروري: <em>write — written, eat — eaten, go — gone</em>.<br>
          للمبني للمجهول في الماضي التام: <strong>had + been + past participle</strong> — مثال: <em>The work had been done.</em>
        </p>
      </div>

      <hr style="border:0;border-top:1px dashed rgba(255,255,255,0.04);margin:12px 0">

      <!-- THIRD CONDITIONAL -->
      <div class="section-title" style="margin-top:8px"><h2>2. The Third Conditional (الحالة الشرطية الثالثة)</h2><div class="badge">Formation & Uses</div></div>

      <div class="rule">
        <h3>التكوين (Formation)</h3>
        <p>
          تركيب الشرط الثالث: <br>
          <strong>If + subject + had + past participle, subject + would/could/might + have + past participle</strong>.<br>
          أمثلة:<br>
          <em>If I had studied harder, I would have passed the test.</em><br>
          أو بديل: <em>If they hadn't slept early, they would have missed their flight.</em>
        </p>
      </div>

      <div class="rule">
        <h3>الاستخدام (Usage)</h3>
        <p>
          1) لتوضيح موقف خيالي أو نتيجة مختلفة كانت ممكنة لكن لم تحدث في الماضي (imaginary past):<br>
          — <em>We would have bought a new house if we had moved to Canada.</em><br><br>
          2) للتعبير عن الندم أو الفرص الضائعة:<br>
          — <em>If I hadn't been nervous, I would have got the job.</em><br><br>
          3) للتعبير عن الأعذار أو الاعتذارات (excuses):<br>
          — <em>If you had told me about the concert, I would have come.</em>
        </p>
      </div>

      <div class="rule">
        <h3>ملاحظات مهمة</h3>
        <p>
          - الشرط الثالث يتعامل دائمًا مع مواقف ماضية لا يمكن تغييرها الآن.<br>
          - لا نستخدم أفعال زمنية محددة (present simple) في الجملة الشرطية هذه إلا ضمن تركيبها الصحيح.<br>
          - يمكن استعمال <strong>wouldn't/couldn't/mightn't + have + p.p.</strong> في الجملة الرئيسية لنفي/إظهار احتمال.
        </p>
      </div>

    </div>

    <!-- QUIZ SECTION (updated for new grammar) -->
    <div class="card quiz" id="quizSection">
      <div class="section-title"><h2>اختبر نفسك — Quiz (Past Perfect & Third Conditional)</h2><div class="badge">Interactive</div></div>

      <!-- Q1: Past Perfect formation -->
      <div class="question" data-answer="b">
        <h4>1) Choose the correct form: "By the time we arrived, they ___ dinner."</h4>
        <div class="choices">
          <div class="choice" data-key="a">have finished</div>
          <div class="choice" data-key="b">had finished</div>
          <div class="choice" data-key="c">finished</div>
          <div class="choice" data-key="d">were finishing</div>
        </div>
      </div>

      <!-- Q2: Negative Past Perfect -->
      <div class="question" data-answer="c">
        <h4>2) Choose the correct negative sentence:</h4>
        <div class="choices">
          <div class="choice" data-key="a">They not had left.</div>
          <div class="choice" data-key="b">They haven't left.</div>
          <div class="choice" data-key="c">They hadn't left.</div>
          <div class="choice" data-key="d">They didn't have left.</div>
        </div>
      </div>

      <!-- Q3: Third conditional -->
      <div class="question" data-answer="a">
        <h4>3) Complete the sentence (Third conditional): "If I ___ earlier, I would have helped you."</h4>
        <div class="choices">
          <div class="choice" data-key="a">had arrived</div>
          <div class="choice" data-key="b">arrived</div>
          <div class="choice" data-key="c">have arrived</div>
          <div class="choice" data-key="d">was arriving</div>
        </div>
      </div>

      <!-- Q4: Third conditional main clause -->
      <div class="question" data-answer="d">
        <h4>4) "If she had known about the test, she ___ it."</h4>
        <div class="choices">
          <div class="choice" data-key="a">would pass</div>
          <div class="choice" data-key="b">will have passed</div>
          <div class="choice" data-key="c">has passed</div>
          <div class="choice" data-key="d">would have passed</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="checkBtn">تحقق من الإجابات</button>
        <button class="btn ghost" id="resetBtn">إعادة الاختبار</button>
      </div>

      <div id="result" style="margin-top:12px;color:var(--muted);font-size:14px"></div>
    </div>

    <!-- popup zoom -->
    <div class="popup-zoom" id="popupZoom" aria-hidden="true" role="dialog" aria-label="Image zoom dialog">
      <div class="popup-inner" role="document">
        <div class="spinner" id="popupSpinner" aria-hidden="true" style="display:none;"></div>

        <button class="btn close" id="popupClose" aria-label="إغلاق">&times;</button>
        <button class="btn prev" id="popupPrev" aria-label="السابق">&#10094;</button>
        <img id="popupImg" src="" alt="Zoomed grammar image" />
        <button class="btn next" id="popupNext" aria-label="التالي">&#10095;</button>

        <div class="caption" id="popupCaption"></div>
      </div>
    </div>

    
  </div>

  <script>
    // Interactive quiz logic
    (function(){
      const questions = Array.from(document.querySelectorAll('.question'));
      questions.forEach(q => {
        q.querySelectorAll('.choice').forEach(choice => {
          choice.addEventListener('click', () => {
            // clear previous selection
            q.querySelectorAll('.choice').forEach(c => c.classList.remove('selected'));
            choice.classList.add('selected');
          });
        });
      });

      document.getElementById('checkBtn').addEventListener('click', () => {
        let correct = 0;
        questions.forEach(q => {
          const answerKey = q.getAttribute('data-answer');
          const selected = q.querySelector('.choice.selected');
          q.querySelectorAll('.choice').forEach(c => c.classList.remove('correct','wrong'));
          if(!selected){
            // no selection -> mark all lightly as wrong
            q.querySelectorAll('.choice').forEach(c => c.classList.add('wrong'));
          } else {
            const key = selected.getAttribute('data-key');
            if(key === answerKey){
              selected.classList.add('correct');
              correct++;
            } else {
              selected.classList.add('wrong');
              // highlight correct
              const correctChoice = q.querySelector('.choice[data-key="'+answerKey+'"]');
              if(correctChoice) correctChoice.classList.add('correct');
            }
          }
        });
        const total = questions.length;
        const result = document.getElementById('result');
        result.innerHTML = 'إجابات صحيحة: ' + correct + ' من ' + total + '.';
      });

      document.getElementById('resetBtn').addEventListener('click', () => {
        questions.forEach(q => {
          q.querySelectorAll('.choice').forEach(c => c.classList.remove('selected','correct','wrong'));
        });
        document.getElementById('result').innerHTML = '';
      });
    })();
  </script>

  <script>
(function(){
  const imgs = Array.from(document.querySelectorAll('.images img, .img-wrap img'));
  if(!imgs.length) return;

  const popup = document.getElementById('popupZoom');
  const popupImg = document.getElementById('popupImg');
  const popupCaption = document.getElementById('popupCaption');
  const spinner = document.getElementById('popupSpinner');
  const btnClose = document.getElementById('popupClose');
  const btnPrev = document.getElementById('popupPrev');
  const btnNext = document.getElementById('popupNext');

  let currentIndex = 0;
  let isZoomed = false;

  function setLoading(on){
    spinner.style.display = on ? 'block' : 'none';
    popupImg.style.visibility = on ? 'hidden' : 'visible';
  }

  function openAt(index){
    currentIndex = (index + imgs.length) % imgs.length;
    const src = imgs[currentIndex].currentSrc || imgs[currentIndex].src || imgs[currentIndex].getAttribute('data-src');
    const alt = imgs[currentIndex].alt || ('Image ' + (currentIndex+1));
    popup.classList.add('open');
    popup.setAttribute('aria-hidden','false');
    document.body.style.overflow = 'hidden';
    setLoading(true);
    popupImg.classList.remove('zoomed');
    isZoomed = false;
    popupImg.src = '';
    popupCaption.textContent = alt;
    const loader = new Image();
    loader.onload = function(){
      popupImg.src = src;
      setLoading(false);
      btnClose.focus();
    };
    loader.onerror = function(){
      setLoading(false);
      popupCaption.textContent = 'خطأ في تحميل الصورة';
    };
    loader.src = src;
  }

  function closePopup(){
    popup.classList.remove('open');
    popup.setAttribute('aria-hidden','true');
    popupImg.src = '';
    popupCaption.textContent = '';
    document.body.style.overflow = '';
    isZoomed = false;
    popupImg.classList.remove('zoomed');
  }

  function showNext(){ openAt(currentIndex + 1); }
  function showPrev(){ openAt(currentIndex - 1); }

  imgs.forEach((img, i) => {
    img.style.cursor = 'zoom-in';
    img.addEventListener('click', (e) => {
      e.preventDefault();
      openAt(i);
    });
    img.addEventListener('keydown', (e) => {
      if(e.key === 'Enter' || e.key === ' ') openAt(i);
    });
  });

  btnClose.addEventListener('click', closePopup);
  btnNext.addEventListener('click', (e)=>{ e.stopPropagation(); showNext(); });
  btnPrev.addEventListener('click', (e)=>{ e.stopPropagation(); showPrev(); });

  popup.addEventListener('click', (e) => {
    if(e.target === popup) closePopup();
  });

  popupImg.addEventListener('click', (e) => {
    if(popupImg.src){
      isZoomed = !isZoomed;
      popupImg.classList.toggle('zoomed', isZoomed);
    }
  });

  document.addEventListener('keydown', (e) => {
    if(!popup.classList.contains('open')) return;
    if(e.key === 'Escape') closePopup();
    else if(e.key === 'ArrowRight' || e.key === 'ArrowDown') showNext();
    else if(e.key === 'ArrowLeft' || e.key === 'ArrowUp') showPrev();
    else if(e.key === '+' || e.key === '='){ isZoomed = true; popupImg.classList.add('zoomed'); }
    else if(e.key === '-' ){ isZoomed = false; popupImg.classList.remove('zoomed'); }
  });

  popupImg.addEventListener('wheel', function(e){
    if(!popup.classList.contains('open')) return;
    e.preventDefault();
    if(e.deltaY < 0) { isZoomed = true; popupImg.classList.add('zoomed'); }
    else { isZoomed = false; popupImg.classList.remove('zoomed'); }
  }, { passive:false });

  // touch swipe
  let startX = 0;
  let startY = 0;
  popup.addEventListener('touchstart', function(e){
    if(!popup.classList.contains('open')) return;
    if(e.touches && e.touches.length === 1){
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    }
  }, {passive:true});

  popup.addEventListener('touchend', function(e){
    if(!popup.classList.contains('open')) return;
    const touch = e.changedTouches && e.changedTouches[0];
    if(!touch) return;
    const dx = touch.clientX - startX;
    const dy = touch.clientY - startY;
    if(Math.abs(dx) > 40 && Math.abs(dx) > Math.abs(dy)){
      if(dx < 0) showNext();
      else showPrev();
    }
  }, {passive:true});

})();
</script>

</body>
</html>
